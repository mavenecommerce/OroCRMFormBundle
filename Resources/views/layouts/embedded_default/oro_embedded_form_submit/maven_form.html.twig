{% block fieldset_widget %}
    <div class="fieldset">
        <h2 class="legend">{{ title|block_text(translation_domain) }}</h2>
        <ul class="form-list">
            {{ block_widget(block) }}
        </ul>
    </div>
{% endblock %}


{% block form_field_widget %}
    <li{% if form.vars.extra_field is defined and form.vars.extra_field %} id="{{ form.vars.id ~ '_holder' }}" {% endif %}>
        {{ form_row(form) }}
    </li>
{% endblock %}

{% block form_widget %}

    <form id="contactFormPopup" action="#" data-toggle="validator" data-focus="false" novalidate="true">
        <div class="row">
            <div class="col-xs-12 col-md-12">
                <div class="form-group">
                    <input type="text" name="nameModalContactUs" id="nameModalContactUs" class="form-control input-lg" placeholder="Your name *" data-error="Please fill out this field" required="">
                    <div class="help-block with-errors"></div>
                </div>
            </div>
            <div class="col-xs-12 col-md-12">
                <div class="form-group">
                    <input type="text" name="contactModalContactUs" id="contactModalContactUs" class="form-control input-lg" placeholder="Your email or phone number *" data-error="Please fill out this field" required="">
                    <div class="help-block with-errors"></div>
                </div>
            </div>
            <div class="col-xs-12 col-md-12">
                <div class="form-group">
                    <textarea name="messageModalContactUs" id="messageModalContactUs" rows="5" class="form-control input-lg" placeholder="Tell us how we can help you with your development process *" data-error="Please fill out this field" required=""></textarea><grammarly-btn><div style="z-index: 2; opacity: 1; transform: translate(552px, 130px);" class="_9b5ef6-textarea_btn _9b5ef6-not_focused" data-grammarly-reactid=".3"><div class="_9b5ef6-transform_wrap" data-grammarly-reactid=".3.0"><div title="Protected by Grammarly" class="_9b5ef6-status" data-grammarly-reactid=".3.0.0">&nbsp;</div></div></div></grammarly-btn>
                    <div class="help-block with-errors textarea"></div>
                </div>
            </div>
        </div>
        <div class="text-center">
            <div class="buttons-set">
                <input type="text" name="hideit" id="hideit" value="" style="display:none !important;">
                <input type="hidden" name="fname" value="">
                <button title="contact us send btn" class="btn btn-info">Contact us now</button>
            </div>
        </div>
    </form>

    <div class="page-title">
        <h1>{% trans %}Contact Us{% endtrans %}</h1>
    </div>
    {{ form_start(form, {'attr': {'id': form.vars.id, 'name': form.vars.name, 'novalidate': 'novalidate' }}) }}
    {{ block_widget(block) }}
    {{ form_end(form) }}
    <script type="text/javascript">
        (function () {
            var Oro = Oro || {};
            Oro.Utils = function () {
                /**
                 * Set Em text node
                 * @param {HTMLElement} el
                 * @param {boolean} required
                 */
                var setRequired = function (el, required) {
                    var labelNode = el.parentNode.previousSibling
                            , emNodes = labelNode.getElementsByTagName('em')
                            , emNode
                            ;

                    if (emNodes.length) {
                        emNode = emNodes[0];
                    } else {
                        emNode = labelNode.createElement('em');
                    }

                    if (emNode) {
                        labelNode.className = labelNode.className.replace(/(\s*required)/, '');
                        if (required) {
                            emNode.innerText = '*';
                            labelNode.className = [labelNode.className, 'required'].join(' ');
                        } else {
                            emNode.innerText = '';
                        }
                    }
                };

                /**
                 * On change listener
                 *
                 * @param {HTMLSelectElement} el
                 */
                this.change = function (el) {
                    var value = el.value
                            , emailFieldId = document.getElementById({{ form.emailAddress.vars.id|json_encode|raw }})
                            , phoneFieldId = document.getElementById({{ form.phone.vars.id|json_encode|raw }})
                            ;

                    if (value === {{ constant('OroCRM\\Bundle\\ContactUsBundle\\Entity\\ContactRequest::CONTACT_METHOD_BOTH')|json_encode|raw }}) {
                        setRequired(emailFieldId, true);
                        setRequired(phoneFieldId, true);
                    } else if (value === {{ constant('OroCRM\\Bundle\\ContactUsBundle\\Entity\\ContactRequest::CONTACT_METHOD_PHONE')|json_encode|raw }}) {
                        setRequired(phoneFieldId, true);
                        setRequired(emailFieldId, false);
                    } else if (value === {{ constant('OroCRM\\Bundle\\ContactUsBundle\\Entity\\ContactRequest::CONTACT_METHOD_EMAIL')|json_encode|raw }}) {
                        setRequired(emailFieldId, true);
                        setRequired(phoneFieldId, false);
                    }
                }
            };

            Oro.Utils = new Oro.Utils();

            var selectEl = document.getElementById({{ form.preferredContactMethod.vars.id|json_encode|raw }});
            selectEl.onchange = function (event) {
                return Oro.Utils.change(event.target);
            }
            Oro.Utils.change(selectEl)
        })();
    </script>
{% endblock %}

{% block _embedded_form_comment_widget %}
    <li class="wide">
        {{ form_row(form) }}
    </li>
{% endblock %}

{% block _embedded_form_submit_widget %}
    <div class="buttons-set">
        <p class="required">{% trans %}orocrm.magentocontactus.required_fields{% endtrans %}</p>
        {{ form_widget(form) }}
    </div>
{% endblock %}
